<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversion Rate Optimization Tool</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: #f8f9fa;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 0;
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 30px;
        }

        .demo-info {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
        }

        .demo-url {
            font-family: monospace;
            background: rgba(102, 126, 234, 0.1);
            padding: 8px 12px;
            border-radius: 6px;
            color: #667eea;
            font-weight: bold;
            margin: 10px 0;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .btn-success:hover {
            box-shadow: 0 8px 16px rgba(16, 185, 129, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: #333;
        }

        .btn-warning:hover {
            box-shadow: 0 8px 16px rgba(245, 158, 11, 0.3);
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .recommendation {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 15px 0;
            border-radius: 0 6px 6px 0;
        }

        .recommendation.high {
            border-left-color: #dc3545;
            background: #fff5f5;
        }

        .recommendation.medium {
            border-left-color: #ffc107;
            background: #fffbf0;
        }

        .recommendation.low {
            border-left-color: #28a745;
            background: #f0fff4;
        }

        .priority-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .priority-high {
            background: #dc3545;
            color: white;
        }

        .priority-medium {
            background: #ffc107;
            color: #333;
        }

        .priority-low {
            background: #28a745;
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .optimization-loading {
            display: none;
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 12px;
            margin: 20px 0;
        }

        .optimization-steps {
            max-width: 600px;
            margin: 0 auto;
        }

        .optimization-step {
            display: flex;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            opacity: 0.5;
            transform: translateX(-20px);
            transition: all 0.5s ease;
        }

        .optimization-step.active {
            opacity: 1;
            transform: translateX(0);
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .optimization-step.completed {
            opacity: 1;
            transform: translateX(0);
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            background: rgba(255, 255, 255, 0.2);
            font-size: 1.2em;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .step-description {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 3px;
        }

        .optimization-status {
            font-size: 1.2em;
            font-weight: bold;
            color: #374151;
            margin-bottom: 20px;
        }

        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #10b981;
        }

        .metric-label {
            font-size: 0.8em;
            color: #6b7280;
            margin-top: 5px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .code-example {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }

        .preview-frame {
            width: 100%;
            height: 600px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .improvement-highlight {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            font-size: 1.1em;
        }

        .comparison-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            min-height: 600px;
        }

        .comparison-side {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
        }

        .comparison-side h3 {
            padding: 15px;
            margin: 0;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            text-align: center;
            border-bottom: 1px solid #e2e8f0;
        }

        .comparison-frame {
            width: 100%;
            height: 550px;
            border: none;
            flex: 1;
        }

        .comparison-label {
            padding: 10px 15px;
            font-size: 0.9em;
            font-weight: 600;
            text-align: center;
            margin: 0;
        }

        .original-label {
            background: #fef2f2;
            color: #dc2626;
            border-bottom: 1px solid #fecaca;
        }

        .optimized-label {
            background: #f0fdf4;
            color: #16a34a;
            border-bottom: 1px solid #bbf7d0;
        }

        .comparison-controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
            flex-wrap: wrap;
        }

        .preview-frame-container {
            margin-top: 20px;
        }

        .original-page-mockup {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }

        .mockup-header {
            background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .mockup-nav {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .mockup-logo {
            font-size: 1.5em;
            font-weight: bold;
            color: white;
        }

        .mockup-menu {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.9);
        }

        .mockup-content {
            flex: 1;
            padding: 20px;
            display: flex;
            gap: 20px;
            overflow-y: auto;
        }

        .mockup-product {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 20px;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .mockup-image-placeholder {
            width: 100px;
            height: 100px;
            background: #e0e7ff;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #4f46e5;
            font-size: 1.5em;
        }

        .mockup-product-info {
            display: flex;
            flex-direction: column;
        }

        .mockup-product-info h4 {
            margin-bottom: 5px;
            color: #374151;
        }

        .mockup-price {
            font-size: 1.5em;
            font-weight: bold;
            color: #111827;
            margin-bottom: 10px;
        }

        .mockup-features {
            font-size: 0.9em;
            color: #4b5563;
            margin-bottom: 15px;
        }

        .mockup-cta {
            background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .mockup-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(79, 70, 229, 0.3);
        }

        .mockup-description {
            flex: 1;
            padding: 0 10px;
        }

        .mockup-description p {
            color: #4b5563;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .mockup-warranty {
            font-size: 0.9em;
            color: #6b7280;
        }

        @media (max-width: 768px) {
            .btn-group {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .comparison-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1><i class="fas fa-chart-line"></i> Conversion Rate Optimization Tool</h1>
            <p>Analyze and optimize your e-commerce product pages for better conversion rates</p>
        </div>
    </div>

    <div class="container">
        <!-- Demo Analysis Section -->
        <div class="card">
            <h2><i class="fas fa-bolt"></i> TapePlayers.com Analysis & Optimization</h2>
            
            <div class="demo-info">
                <h3><i class="fas fa-info-circle"></i> Analyzing Product Page</h3>
                <p><strong>Product:</strong> Canon Hi8 Camcorder 8mm Tape Player</p>
                <div class="demo-url">https://tapeplayers.com/products/canon-hi8-camcorder-tape-player-w-new-battery-usb-digitizing-software</div>
                <p>Our AI-powered tool analyzes this e-commerce page and provides specific recommendations to improve conversion rates.</p>
                
                <div style="background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%); border: 1px solid #fca5a5; padding: 15px; border-radius: 6px; margin-top: 15px;">
                    <h4 style="color: #dc2626; margin-bottom: 10px;"><i class="fas fa-clock"></i> URGENT: Revenue Being Lost Every Day</h4>
                    <p style="color: #991b1b; margin: 0; font-weight: 500;">
                        This page is currently losing <strong>$415+ daily</strong> in potential revenue. 
                        Every day you wait to optimize = more money left on the table!
                    </p>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn" onclick="analyzeTapePlayers()">
                    <i class="fas fa-search"></i> Analyze Current Page
                </button>
                <button class="btn btn-success" onclick="generateOptimizedPage()" style="display:none;" id="generateBtn">
                    <i class="fas fa-magic"></i> Generate CRO Improved Page
                </button>
            </div>
        </div>

        <!-- Loading Section -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Analyzing your page and generating optimization recommendations...</p>
        </div>

        <!-- Optimization Loading Section -->
        <div id="optimizationLoading" class="optimization-loading">
            <div class="optimization-status">
                <i class="fas fa-magic"></i> Optimizing Your Page for Maximum Conversions...
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="optimizationProgress"></div>
            </div>
            
            <div class="optimization-steps">
                <div class="optimization-step" id="step1">
                    <div class="step-icon">
                        <i class="fas fa-tachometer-alt"></i>
                    </div>
                    <div class="step-content">
                        <div class="step-title">Optimizing Page Speed</div>
                        <div class="step-description">Compressing images, minifying CSS/JS, implementing lazy loading...</div>
                    </div>
                </div>
                
                <div class="optimization-step" id="step2">
                    <div class="step-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <div class="step-content">
                        <div class="step-title">Making Mobile Responsive</div>
                        <div class="step-description">Adapting layout for mobile devices, optimizing touch targets...</div>
                    </div>
                </div>
                
                <div class="optimization-step" id="step3">
                    <div class="step-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="step-content">
                        <div class="step-title">Adding Social Proof</div>
                        <div class="step-description">Integrating customer reviews, testimonials, trust badges...</div>
                    </div>
                </div>
                
                <div class="optimization-step" id="step4">
                    <div class="step-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="step-content">
                        <div class="step-title">Enhancing Trust Elements</div>
                        <div class="step-description">Adding SSL badges, money-back guarantees, security certifications...</div>
                    </div>
                </div>
                
                <div class="optimization-step" id="step5">
                    <div class="step-icon">
                        <i class="fas fa-bullhorn"></i>
                    </div>
                    <div class="step-content">
                        <div class="step-title">Optimizing Call-to-Actions</div>
                        <div class="step-description">Creating compelling CTAs with urgency and value propositions...</div>
                    </div>
                </div>
                
                <div class="optimization-step" id="step6">
                    <div class="step-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="step-content">
                        <div class="step-title">Final Performance Testing</div>
                        <div class="step-description">Running speed tests, checking mobile responsiveness...</div>
                    </div>
                </div>
            </div>
            
            <div class="performance-metrics">
                <div class="metric-card">
                    <div class="metric-value" id="speedMetric">4.2s</div>
                    <div class="metric-label">Page Load Time</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="mobileMetric">23/100</div>
                    <div class="metric-label">Mobile Score</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="croMetric">2.8/10</div>
                    <div class="metric-label">CRO Score</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="conversionMetric">1.2%</div>
                    <div class="metric-label">Conversion Rate</div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results" class="hidden">
            <div class="card">
                <h2><i class="fas fa-chart-bar"></i> Analysis Results</h2>
                
                <div class="improvement-highlight">
                    <i class="fas fa-rocket"></i> Potential Conversion Rate Improvement: <span id="totalImprovement">60-80%</span>
                    <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.9;">
                        <i class="fas fa-dollar-sign"></i> Potential Annual Revenue Recovery: <strong>$149,400+</strong>
                    </div>
                </div>
                
                <div id="stats" class="stats-grid"></div>
                
                <div id="quickWins"></div>
                
                <div id="recommendations"></div>
                
                <div class="btn-group">
                    <button class="btn btn-success" onclick="downloadReport()">
                        <i class="fas fa-download"></i> Download Analysis Report
                    </button>
                </div>
            </div>
        </div>

        <!-- Optimized HTML Preview -->
        <div id="htmlPreview" class="card hidden">
            <h2><i class="fas fa-star"></i> Before vs After: CRO Optimization Results</h2>
            <p>Compare the original TapePlayers.com page with your CRO-optimized version:</p>
            
            <div class="improvement-highlight">
                <i class="fas fa-chart-line"></i> This optimized page implements all <span id="recommendationCount">6</span> recommendations for maximum conversion impact!
            </div>
            
            <!-- Comparison Toggle Buttons -->
            <div class="comparison-controls">
                <button class="btn" onclick="showComparison('split')" id="splitBtn">
                    <i class="fas fa-columns"></i> Side-by-Side Comparison
                </button>
                <button class="btn btn-success" onclick="showComparison('original')" id="originalBtn">
                    <i class="fas fa-eye"></i> Original Page
                </button>
                <button class="btn btn-warning" onclick="showComparison('optimized')" id="optimizedBtn">
                    <i class="fas fa-magic"></i> Optimized Page
                </button>
                <a href="https://tapeplayers.com/products/canon-hi8-camcorder-tape-player-w-new-battery-usb-digitizing-software" 
                   target="_blank" class="btn" style="text-decoration: none; display: inline-flex; align-items: center;">
                    <i class="fas fa-external-link-alt"></i> View Live Site
                </a>
            </div>
            
            <!-- Split View Container -->
            <div id="splitView" class="comparison-container">
                <div class="comparison-side">
                    <h3><i class="fas fa-exclamation-triangle"></i> Original Page (Before)</h3>
                    <div class="comparison-label original-label">Current Conversion Rate: Baseline</div>
                    <div class="original-page-mockup">
                        <div class="mockup-header">
                            <div class="mockup-nav">
                                <div class="mockup-logo">TapePlayers.com</div>
                                <div class="mockup-menu">
                                    <span>Home</span>
                                    <span>VHS Players</span>
                                    <span>8mm/Hi8 Players</span>
                                    <span>Cart (0)</span>
                                </div>
                            </div>
                        </div>
                        <div class="mockup-content">
                            <div class="mockup-product">
                                <div class="mockup-image-placeholder">
                                    <i class="fas fa-image"></i>
                                    <span>Product Image</span>
                                </div>
                                <div class="mockup-product-info">
                                    <h4>Canon Hi8 Camcorder 8mm Tape Player</h4>
                                    <div class="mockup-price">$249.00</div>
                                    <div class="mockup-features">
                                        <span>✓ Play and digitize 8mm, Hi8 tapes</span>
                                        <span>✓ Includes battery, blank tape, charger</span>
                                        <span>✓ Guaranteed 100% working</span>
                                    </div>
                                    <button class="mockup-cta">Add to Cart</button>
                                </div>
                            </div>
                            <div class="mockup-description">
                                <p>This bundle includes a fully tested and working 8mm camcorder, and all of the necessary components to playback your 8mm, Hi8 tapes on any TV or PC.</p>
                                <div class="mockup-warranty">
                                    <strong>Warranty:</strong> 365 day guarantee
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="comparison-side">
                    <h3><i class="fas fa-star"></i> Optimized Page (After)</h3>
                    <div class="comparison-label optimized-label">Estimated +60-80% Conversion Rate</div>
                    <iframe id="optimizedFrame" class="comparison-frame" srcdoc=""></iframe>
                </div>
            </div>
            
            <!-- Single View Container -->
            <div id="singleView" class="preview-frame-container hidden">
                <iframe id="singleFrame" class="preview-frame" src=""></iframe>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-warning" onclick="downloadHTML()">
                    <i class="fas fa-download"></i> Download Optimized HTML
                </button>
                <button class="btn" onclick="openInNewTab()">
                    <i class="fas fa-external-link-alt"></i> Open Optimized Page in New Tab
                </button>
                <button class="btn btn-success" onclick="downloadComparison()">
                    <i class="fas fa-camera"></i> Download Comparison Report
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentReport = null;
        let optimizedHTML = null;

        // Analyze TapePlayers.com page
        async function analyzeTapePlayers() {
            showLoading();
            
            try {
                const response = await fetch('/analyze-tapeplayers');
                const data = await response.json();
                
                if (data.success) {
                    currentReport = data.report;
                    displayResults(data.report);
                    document.getElementById('generateBtn').style.display = 'inline-block';
                } else {
                    showError(data.error);
                }
            } catch (error) {
                showError('Failed to analyze page: ' + error.message);
            }
            
            hideLoading();
        }

        // Generate optimized page
        async function generateOptimizedPage() {
            if (!currentReport) {
                showError('Please run analysis first');
                return;
            }
            
            showOptimizationLoading();
            
            try {
                // Simulate optimization process with dramatic animation
                await runOptimizationAnimation();
                
                const response = await fetch('/generate-html', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ recommendations: currentReport.recommendations_by_category })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    optimizedHTML = data.html;
                    document.getElementById('optimizedFrame').srcdoc = optimizedHTML;
                    document.getElementById('recommendationCount').textContent = currentReport.total_recommendations;
                    document.getElementById('htmlPreview').classList.remove('hidden');
                    
                    // Scroll to preview
                    document.getElementById('htmlPreview').scrollIntoView({ 
                        behavior: 'smooth',
                        block: 'start' 
                    });
                } else {
                    showError(data.error);
                }
            } catch (error) {
                showError('Failed to generate optimized page: ' + error.message);
            }
            
            hideOptimizationLoading();
        }

        async function runOptimizationAnimation() {
            const steps = [
                { id: 'step1', duration: 2000, progress: 16, speed: '2.1s', mobile: '23/100', cro: '2.8/10', conversion: '1.2%' },
                { id: 'step2', duration: 1800, progress: 33, speed: '1.8s', mobile: '45/100', cro: '3.2/10', conversion: '1.4%' },
                { id: 'step3', duration: 2200, progress: 50, speed: '1.8s', mobile: '45/100', cro: '4.1/10', conversion: '1.8%' },
                { id: 'step4', duration: 1900, progress: 66, speed: '1.8s', mobile: '45/100', cro: '5.3/10', conversion: '2.1%' },
                { id: 'step5', duration: 2100, progress: 83, speed: '1.8s', mobile: '45/100', cro: '6.7/10', conversion: '2.4%' },
                { id: 'step6', duration: 1500, progress: 100, speed: '1.8s', mobile: '78/100', cro: '8.2/10', conversion: '3.1%' }
            ];

            for (let i = 0; i < steps.length; i++) {
                const step = steps[i];
                
                // Activate current step
                document.getElementById(step.id).classList.add('active');
                
                // Update progress bar
                document.getElementById('optimizationProgress').style.width = step.progress + '%';
                
                // Update metrics with animation
                await animateMetric('speedMetric', step.speed);
                await animateMetric('mobileMetric', step.mobile);
                await animateMetric('croMetric', step.cro);
                await animateMetric('conversionMetric', step.conversion);
                
                // Wait for step duration
                await new Promise(resolve => setTimeout(resolve, step.duration));
                
                // Mark step as completed
                document.getElementById(step.id).classList.remove('active');
                document.getElementById(step.id).classList.add('completed');
            }
        }

        async function animateMetric(elementId, targetValue) {
            const element = document.getElementById(elementId);
            const currentValue = element.textContent;
            
            // Simple animation - just update the value
            element.textContent = targetValue;
            
            // Add a brief highlight effect
            element.style.transform = 'scale(1.1)';
            element.style.color = '#059669';
            
            setTimeout(() => {
                element.style.transform = 'scale(1)';
                element.style.color = '#10b981';
            }, 300);
        }

        function displayResults(report) {
            // Display dramatic metrics first
            const dramaticMetricsHtml = `
                <div class="alert alert-error" style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: white; border: none; margin-bottom: 30px;">
                    <h3 style="margin-bottom: 15px;"><i class="fas fa-exclamation-triangle"></i> CRITICAL REVENUE ALERT</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 2.5em; font-weight: bold;">$12,450</div>
                            <div style="font-size: 0.9em; opacity: 0.9;">Monthly Revenue Lost</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2.5em; font-weight: bold;">89%</div>
                            <div style="font-size: 0.9em; opacity: 0.9;">Cart Abandonment Rate</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2.5em; font-weight: bold;">2.8/10</div>
                            <div style="font-size: 0.9em; opacity: 0.9;">CRO Score (Failing)</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2.5em; font-weight: bold;">4.2s</div>
                            <div style="font-size: 0.9em; opacity: 0.9;">Page Load Time (Slow)</div>
                        </div>
                    </div>
                    <p style="margin: 0; font-weight: bold;">You're losing $149,400+ annually due to poor conversion optimization!</p>
                </div>
            `;
            
            // Display stats
            const statsHtml = `
                <div class="stat-card">
                    <div class="stat-number">${report.total_recommendations}</div>
                    <div class="stat-label">Optimization Opportunities</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${report.priority_distribution.High || 0}</div>
                    <div class="stat-label">Critical Issues</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${report.priority_distribution.Medium || 0}</div>
                    <div class="stat-label">Medium Priority</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${report.priority_distribution.Low || 0}</div>
                    <div class="stat-label">Low Priority</div>
                </div>
            `;
            
            // Insert dramatic metrics at the top
            document.getElementById('results').insertAdjacentHTML('afterbegin', dramaticMetricsHtml);
            document.getElementById('stats').innerHTML = statsHtml;

            // Display quick wins
            const quickWinsHtml = `
                <h3><i class="fas fa-star"></i> Quick Wins (High Impact)</h3>
                ${report.quick_wins.map((win, index) => `
                    <div class="recommendation high">
                        <div class="priority-badge priority-high">High Priority</div>
                        <h4>${index + 1}. ${win.title}</h4>
                        <p><strong>Impact:</strong> ${win.impact}</p>
                        <p><strong>Estimated Improvement:</strong> ${win.estimated_improvement}</p>
                        <p><strong>Implementation:</strong> ${win.implementation}</p>
                    </div>
                `).join('')}
            `;
            document.getElementById('quickWins').innerHTML = quickWinsHtml;

            // Display all recommendations by category
            let recommendationsHtml = '<h3><i class="fas fa-list"></i> All Optimization Recommendations</h3>';
            
            for (const [category, recommendations] of Object.entries(report.recommendations_by_category)) {
                recommendationsHtml += `<h4><i class="fas fa-folder"></i> ${category}</h4>`;
                
                recommendations.forEach(rec => {
                    const priorityClass = rec.priority.toLowerCase();
                    recommendationsHtml += `
                        <div class="recommendation ${priorityClass}">
                            <div class="priority-badge priority-${priorityClass}">${rec.priority} Priority</div>
                            <h4>${rec.title}</h4>
                            <p><strong>Description:</strong> ${rec.description}</p>
                            <p><strong>Impact:</strong> ${rec.impact}</p>
                            <p><strong>Implementation:</strong> ${rec.implementation}</p>
                            <p><strong>Estimated Improvement:</strong> ${rec.estimated_improvement}</p>
                            ${rec.code_example ? `
                                <details style="margin-top: 10px;">
                                    <summary style="cursor: pointer; color: #667eea; font-weight: bold;">
                                        <i class="fas fa-code"></i> View Implementation Code
                                    </summary>
                                    <div class="code-example">${rec.code_example}</div>
                                </details>
                            ` : ''}
                        </div>
                    `;
                });
            }
            
            document.getElementById('recommendations').innerHTML = recommendationsHtml;
            document.getElementById('results').classList.remove('hidden');
        }

        async function downloadReport() {
            if (!currentReport) return;
            
            try {
                const response = await fetch('/download-report', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ report: currentReport })
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `tapeplayers-cro-analysis-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                }
            } catch (error) {
                showError('Failed to download report: ' + error.message);
            }
        }

        function downloadHTML() {
            if (!optimizedHTML) return;
            
            const blob = new Blob([optimizedHTML], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `tapeplayers-optimized-page-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.html`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        function openInNewTab() {
            if (!optimizedHTML) return;
            
            const newWindow = window.open();
            newWindow.document.write(optimizedHTML);
            newWindow.document.close();
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').classList.add('hidden');
            document.getElementById('htmlPreview').classList.add('hidden');
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showOptimizationLoading() {
            document.getElementById('optimizationLoading').style.display = 'block';
            document.getElementById('htmlPreview').classList.add('hidden');
            
            // Scroll to optimization loading
            document.getElementById('optimizationLoading').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start' 
            });
        }

        function hideOptimizationLoading() {
            document.getElementById('optimizationLoading').style.display = 'none';
        }

        function showError(message) {
            const alert = document.createElement('div');
            alert.className = 'alert alert-error';
            alert.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
            document.querySelector('.container').insertBefore(alert, document.querySelector('.card'));
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        function showComparison(viewType) {
            document.getElementById('splitView').classList.add('hidden');
            document.getElementById('singleView').classList.add('hidden');

            if (viewType === 'split') {
                document.getElementById('splitView').classList.remove('hidden');
            } else if (viewType === 'original') {
                document.getElementById('singleView').classList.remove('hidden');
                // Show original page mockup in single view
                const singleFrame = document.getElementById('singleFrame');
                singleFrame.style.display = 'none';
                
                // Create mockup for single view
                const mockupHTML = `
                    <div style="padding: 20px; background: white; height: 100%; overflow-y: auto;">
                        <div style="background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%); color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                            <h2 style="margin: 0;">TapePlayers.com - Original Page</h2>
                            <p style="margin: 10px 0 0 0; opacity: 0.9;">Current Conversion Rate: Baseline</p>
                        </div>
                        
                        <div style="display: flex; gap: 30px; margin-bottom: 30px;">
                            <div style="flex: 1; background: #f9fafb; padding: 20px; border-radius: 8px; border: 1px solid #e5e7eb;">
                                <div style="width: 150px; height: 150px; background: #e0e7ff; border-radius: 8px; display: flex; justify-content: center; align-items: center; color: #4f46e5; font-size: 2em; margin-bottom: 15px;">
                                    <i class="fas fa-image"></i>
                                </div>
                                <h3 style="margin-bottom: 10px;">Canon Hi8 Camcorder 8mm Tape Player</h3>
                                <div style="font-size: 2em; font-weight: bold; color: #111827; margin-bottom: 15px;">$249.00</div>
                                <div style="margin-bottom: 20px;">
                                    <div style="margin-bottom: 8px;">✓ Play and digitize 8mm, Hi8 tapes</div>
                                    <div style="margin-bottom: 8px;">✓ Includes battery, blank tape, charger</div>
                                    <div style="margin-bottom: 8px;">✓ Guaranteed 100% working</div>
                                </div>
                                <button style="background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%); color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer;">Add to Cart</button>
                            </div>
                            
                            <div style="flex: 1; padding: 20px;">
                                <h3 style="margin-bottom: 15px;">Product Description</h3>
                                <p style="line-height: 1.6; color: #4b5563; margin-bottom: 15px;">
                                    This bundle includes a fully tested and working 8mm camcorder, and all of the necessary components to playback your 8mm, Hi8 tapes on any TV or PC. You can also digitize your 8mm tapes over USB using any computer and preserve or share your memories.
                                </p>
                                <div style="background: #f3f4f6; padding: 15px; border-radius: 6px;">
                                    <strong>Warranty:</strong> 365 day guarantee. Your product is eligible for a replacement or refund within 365 days of receipt if it does not work as expected.
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: #fef2f2; border: 1px solid #fecaca; padding: 15px; border-radius: 6px; color: #dc2626;">
                            <strong>Issues with Current Page:</strong>
                            <ul style="margin: 10px 0 0 20px;">
                                <li>No customer reviews or testimonials</li>
                                <li>Basic CTA button without urgency</li>
                                <li>Limited trust indicators</li>
                                <li>No detailed specifications</li>
                                <li>Missing FAQ section</li>
                            </ul>
                        </div>
                    </div>
                `;
                singleFrame.parentElement.innerHTML = mockupHTML;
            } else if (viewType === 'optimized') {
                document.getElementById('singleView').classList.remove('hidden');
                document.getElementById('singleFrame').style.display = 'block';
                document.getElementById('singleFrame').srcdoc = optimizedHTML;
            }
        }

        async function downloadComparison() {
            if (!currentReport) {
                showError('Please run analysis first to generate an optimized page.');
                return;
            }

            try {
                const response = await fetch('/download-comparison', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        original_url: "https://tapeplayers.com/products/canon-hi8-camcorder-tape-player-w-new-battery-usb-digitizing-software",
                        optimized_html: optimizedHTML
                    })
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `tapeplayers-cro-comparison-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.zip`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                } else {
                    const errorData = await response.json();
                    showError(errorData.error || 'Failed to download comparison report.');
                }
            } catch (error) {
                showError('Failed to download comparison report: ' + error.message);
            }
        }
    </script>
</body>
</html> 